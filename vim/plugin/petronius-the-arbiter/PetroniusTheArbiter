" vim:set ft=vim:

source $pete/pete/Base

source $pete/pete/Python
source $pete/pete/Shell
source $pete/pete/Vim
source $pete/pete/Scala
source $pete/pete/Html
source $pete/pete/Javascript
source $pete/pete/Css

let $PETE_COMMENT_ON  = 0
let $PETE_COMMENT_OFF = 1
let $PETE_COMMENT_OFF = 2
let $PETE_RUN         = 3
let $PETE_RELOAD      = 4

augroup autocmdPete
	autocmd!
augroup END

autocmd autocmdPete BufEnter  *.scala set filetype=scala

function! PetroniusTheArbiter(mode) range
python <<EOM

import vim

mode      = vim.eval('a:mode')
firstLine = int(vim.eval('a:firstline'))
lastLine  = int(vim.eval('a:lastline'))
fileType  = vim.eval('&filetype')

call(mode, fileType, firstLine, lastLine)

EOM
endfunction

python <<EOM

def call(mode, fileType, firstLine, lastLine):
	pete = createPete(fileType)

	if mode == vim.eval('$PETE_COMMENT_ON'):
		pete.commentOn(firstLine, lastLine)

	elif mode == vim.eval('$PETE_COMMENT_OFF'):
		pete.commentOff(firstLine, lastLine)
	
	elif mode == vim.eval('$PETE_COMMENT_SWITCH'):
		pete.commentSwitch(firstLine, lastLine)
	
	elif mode == vim.eval('$PETE_RUN'):
		pete.run()

	elif mode == vim.eval('$PETE_RELOAD'):
		pete.browserReload()
	
def createPete(fileType):
	if fileType == 'python':
		return Python()

	elif fileType == 'sh':
		return Shell()

	elif fileType == 'vim':
		return Vim()

	elif fileType == 'scala':
		return Scala()

	elif fileType == 'html':
		return Html()

	elif fileType == 'javascript':
		return Javascript()

	elif fileType == 'css':
		return Css()

EOM
