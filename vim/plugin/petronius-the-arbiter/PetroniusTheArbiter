" vim:set ft=vim:

source $pete/pete/Base

source $pete/pete/Python
source $pete/pete/Shell
source $pete/pete/Vim

let $PETE_COMMENT_ON  = 0
let $PETE_COMMENT_OFF = 1
let $PETE_COMMENT_OFF = 2
let $PETE_RUN         = 3

function! PetroniusTheArbiter(mode) range
python <<EOM

import vim

mode      = vim.eval('a:mode')
firstLine = int(vim.eval('a:firstline'))
lastLine  = int(vim.eval('a:lastline'))
fileType  = vim.eval('&filetype')

call(mode, fileType, firstLine, lastLine)

EOM
endfunction

python <<EOM

def call(mode, fileType, firstLine, lastLine):
	pete = createPete(fileType)

	if mode == vim.eval('$PETE_COMMENT_ON'):
		pete.commentOn(firstLine, lastLine)

	elif mode == vim.eval('$PETE_COMMENT_OFF'):
		pete.commentOff(firstLine, lastLine)
	
	elif mode == vim.eval('$PETE_COMMENT_SWITCH'):
		pete.commentSwitch(firstLine, lastLine)
	
	elif mode == vim.eval('$PETE_RUN'):
		pete.run()
	
def createPete(fileType):
	if fileType == 'python':
		return Python()

	elif fileType == 'sh':
		return Shell()

	elif fileType == 'vim':
		return Vim()

EOM
